---
id: CHG-002
upstream_range: "rust-v0.94.0 -> rust-v0.98.0"
area:
  - codex-rs
  - vscode-extension
type:
  - ui
  - behavior
  - api
status: decided # draft | decided | implemented | verified
---

# Upstream変更: Collaboration mode の整理と命名同期

## 1. 観察事実（upstreamで何が変わったか）

- 変更内容:
- visible mode を default/plan に簡約し、legacy 名は default に正規化。
- ModeKind の表示名/可視性/req_user_input 可否をメタデータ化。
- TUI/プロンプト/ツール側で命名を同期。
- upstreamの根拠:
  - 該当PR/コミット/リリースノート:
    - d509df676
    - 41b4962b0
  - 仕様/挙動の要点（箇条書き）:
    - visible mode を default/plan に簡約し、legacy 名は default に正規化。
    - ModeKind の表示名/可視性/req_user_input 可否をメタデータ化。
    - TUI/プロンプト/ツール側で命名を同期。

## 2. 影響（何がどう変わるか）

- 影響範囲（ユーザー導線）:
- TUI/VSCode のモード表示と切替導線が変わる。
- 外部連携の旧 mode 名は default に吸収される。
- 互換性（既存設定/既存thread/既存運用）:
  - 既存設定は基本維持。破壊的変更がある場合は明示。
- 破壊的変更の有無:
  - なし
- セキュリティ/コンプライアンス観点（あれば）:
  - 追加があれば README_codez.md に明記。

## 3. 対応方針（ここを“決定”する）

### 3.1 codez（Rust/CLI/TUI/周辺ツール）

- 方針: 採用
- 理由（制約・コスト・安全性・整合性）: upstream と仕様を揃え、互換変換は upstream のルールを踏襲。
- 移行方針（必要なら）: 旧 mode 名は default に正規化（互換）。

### 3.2 VSCode拡張

- 方針: 追随
- 理由（upstream整合・UX・実装制約）: UI 表示/切替の整合性を確保。
- 代替導線（未対応なら、どう見せる/どう説明する）: なし

## 4. ユーザーが決める質問（未確定点）

- なし

## 5. 受け入れ条件（成功判定）

- CLI/TUI:
- TUI/CLI: visible mode が default/plan のみ。
- VSCode:
- VSCode: 入力欄で Shift+Tab で mode トグル。
- VSCode: 左下モデル表示の左に現在 mode 表示。
- VSCode: 切替時にチャット内システムカードを出力（固定文言）。
- 互換性（既存設定で壊れない/壊れるならエラーで露呈させる）:
  - 既存設定の読み込みを維持し、破壊的変更はエラー/ドキュメントで露呈。
- ドキュメント更新:
  - `README_codez.md`:
- README_codez.md に mode 整理の差分を記載。
  - `vscode-extension/CHANGELOG.md`:
- vscode-extension/CHANGELOG.md に UI 変更を追記。

## 6. 実装メモ（決定後に埋める）

- 変更箇所: TBD
- テスト/検証コマンド: TBD
- リスクとロールバック: TBD
